# PRD: 헤더/푸터 필터링 기능

## 1. 개요 (Overview)

### 목적
PDF에서 텍스트 추출 시 페이지 헤더/푸터 영역의 불필요한 내용(페이지 번호, 러닝 헤더)을 제거하여 깨끗한 마크다운 출력을 생성한다.

### 범위
- **포함**: 헤더/푸터 여백 적용, 페이지 번호 제거, 중복 섹션 제목 제거
- **제외**: 사용자 정의 여백 설정 UI

### 성공 기준
- 추출된 텍스트에서 페이지 번호가 제거된다
- 러닝 헤더로 인한 섹션 제목 중복이 제거된다
- 기존 테스트가 모두 통과한다

## 2. 기능 명세 (Functional Specifications)

### 2.1 사용자 스토리
- As a 사용자, I want 깨끗한 마크다운 출력, so that 불필요한 페이지 번호와 중복 제목 없이 문서를 활용할 수 있다

### 2.2 수락 기준 (Acceptance Criteria)
- [x] Given 페이지 번호가 포함된 PDF, When 텍스트 추출, Then 단독 숫자 라인 제거
- [x] Given 러닝 헤더가 있는 PDF, When 텍스트 추출, Then 헤더 영역(상단 50pt) 제외
- [x] Given 푸터가 있는 PDF, When 텍스트 추출, Then 푸터 영역(하단 50pt) 제외
- [x] Given 섹션 제목과 동일한 첫 줄, When 마크다운 변환, Then 중복 제목 제거
- [x] Given 본문 내 숫자, When 텍스트 추출, Then 숫자 유지

### 2.3 기능 상세

| 기능 ID | 설명 | 우선순위 | 상태 |
|---------|------|----------|------|
| F-HF-001 | 헤더 여백 상수 (50pt) | P1 | Done |
| F-HF-002 | 푸터 여백 상수 (50pt) | P1 | Done |
| F-HF-003 | extract_text()에 여백 적용 | P1 | Done |
| F-HF-004 | extract_tables()에 여백 적용 | P1 | Done |
| F-HF-005 | 페이지 번호 정규식 제거 | P1 | Done |
| F-HF-006 | 중복 섹션 제목 제거 | P1 | Done |

## 3. 기술 명세 (Technical Specifications)

### 3.1 아키텍처

```
┌─────────────────────────────────────────────────────────────┐
│                   PDF 페이지 구조                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  헤더 영역 (0 ~ 50pt) - 러닝 헤더 제외               │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │                                                     │   │
│  │              본문 영역 (50pt ~ H-50pt)              │   │
│  │                                                     │   │
│  ├─────────────────────────────────────────────────────┤   │
│  │  푸터 영역 (H-50pt ~ H) - 페이지 번호 제외          │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                 text_to_markdown() 후처리                   │
│  1. 단독 페이지 번호 제거: ^\s*\d+\s*$                      │
│  2. 중복 섹션 제목 제거 (첫 줄이 제목과 일치 시)            │
│  3. 연속 빈 줄 정리                                        │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 상수 정의

```python
# core/pdf_reader.py
HEADER_MARGIN = 50.0  # 상단 헤더 여백 (pt)
FOOTER_MARGIN = 50.0  # 하단 푸터 여백 (pt)
```

### 3.3 변경된 함수

#### pdf_reader.py
- `extract_text()`: 클리핑 영역에 HEADER_MARGIN, FOOTER_MARGIN 적용
- `extract_tables()`: 유효 범위에 HEADER_MARGIN, FOOTER_MARGIN 적용

#### md_converter.py
- `text_to_markdown(text, section_title=None)`:
  - 페이지 번호 제거 정규식 추가
  - section_title 매개변수로 중복 제목 제거

## 4. 테스트 계획 (Test Plan)

### 4.1 테스트 범위
- 단위 테스트: 페이지 번호 제거, 중복 제목 제거, 여백 상수
- 통합 테스트: 전체 파이프라인

### 4.2 테스트 케이스

| TC-ID | 설명 | 타입 | 상태 |
|-------|------|------|------|
| TC-HF-001 | 단독 숫자 라인 제거 | Unit | Pass |
| TC-HF-002 | 공백 포함 숫자 라인 제거 | Unit | Pass |
| TC-HF-003 | 본문 내 숫자 유지 | Unit | Pass |
| TC-HF-004 | 중복 제목 제거 (번호 없는 제목) | Unit | Pass |
| TC-HF-005 | 헤더 여백 상수 확인 | Unit | Pass |
| TC-HF-006 | 푸터 여백 상수 확인 | Unit | Pass |
| TC-HF-007 | 빈 텍스트 처리 | Unit | Pass |
| TC-HF-008 | 전체 파이프라인 통합 | Integration | Pass |

## 5. 구현 체크리스트

- [x] Phase 1: 테스트 케이스 작성 (15개)
- [x] Phase 2: pdf_reader.py 여백 상수 및 로직 구현
- [x] Phase 3: md_converter.py 필터링 로직 구현
- [x] Phase 4: 테스트 실행 및 검증 (28/28 통과)
- [x] Phase 5: 문서화 완료

## 6. 변경된 파일

| 파일 | 변경 내용 |
|------|----------|
| `core/pdf_reader.py` | `HEADER_MARGIN`, `FOOTER_MARGIN` 상수 추가, `extract_text()`, `extract_tables()` 수정 |
| `core/md_converter.py` | `text_to_markdown()` 수정 (section_title 매개변수, 페이지 번호/중복 제목 제거) |
| `tests/test_header_footer_filter.py` | 15개 단위 테스트 추가 |
